v.names <- v.names[-1]
n <- length(v.names)
n
sex <- "men" # width=400, hights=230
m.tstate_con <- colSums(a.prop[1:10,c("mci","mil","mod","sev"),,"con",sex])
m.tstate_int <- colSums(a.prop[1:10,c("mci","mil","mod","sev"),,"int",sex])
m.tstate_dif <- m.tstate_int - m.tstate_con
par(mar = c(1,6,1,1))
barplot(height = rep(NA,n), horiz = TRUE, xlim=c(0,10), las=1, xlab="person-years")
title(ylab="men", line=5)
grid(nx = NULL, ny = NA, lty = 1, col = "lightgray")
barplot(height = m.tstate_con[,c(n:1)], horiz = TRUE, col=c("green","yellow","orange","red"), xlim=c(0,10), border=NA, las=1, add=TRUE)
par(mar = c(1,5,1,1))
m.tstate_dif_neg <- m.tstate_dif_pos <- m.tstate_dif
m.tstate_dif_neg[m.tstate_dif_neg>=0] <- 0
m.tstate_dif_pos[m.tstate_dif_pos<0 ] <- 0
barplot(height = rep(NA,n), horiz = TRUE, xlim = c(-1.5,1.5), las=1, xlab="person-years")
grid(nx = NULL, ny = NA, lty = 1, col = "lightgray")
barplot(height = m.tstate_dif_pos[,c(n:1)], horiz = TRUE, xlim = c(-1.5,1.5), col=c("green","yellow","orange","red"), border=NA, las=1, add=TRUE)
barplot(height = m.tstate_dif_neg[,c(n:1)], horiz = TRUE, xlim = c(-1.5,1.5), col=c("green","yellow","orange","red"), border=NA, las=1, add=TRUE)
debugSource("~/GitHub/IPECAD/AD open-source model.R", echo=TRUE)
## plot: mean time in state
m.plot2 <- cbind(soc=colSums(m.plot1_soc), int=colSums(m.plot1_int))
m.plot2 <- m.plot2[c("mci","mil","mod","sev"),]
temp.dif <- m.plot2[,"int"] - m.plot2[,"soc"]
temp.dif
temp.dif <- m.plot2[,"int"] - m.plot2[,"soc"] # difference in time in state
m.plot2_neg <- m.plot2_pos <- temp.dif # split positive and negative differences
m.plot2_neg[m.plot2_neg>=0] <- 0
m.plot2_pos[m.plot2_pos<0 ] <- 0
m.plot2_pos
barplot(height = rep(NA,n), horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
barplot(height = m.plot2_neg, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
barplot(height = m.plot2_pos, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
barplot(height = m.plot2_neg, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
barplot(height = m.plot2_pos, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years", add=TRUE)
barplot(height = t(m.plot2_neg), horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
m.plot2_neg
barplot(height = t(t(m.plot2_neg)), horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
temp.dif <- m.plot2[,"int"] - m.plot2[,"soc"] # difference in time in state
temp.dif
temp.dif <- t(m.plot2[,"int"] - m.plot2[,"soc"]) # difference in time in state
temp.dif
temp.dif <- t(t(m.plot2[,"int"] - m.plot2[,"soc"])) # difference in time in state
temp.dif
m.plot2_neg <- m.plot2_pos <- temp.dif # split positive and negative differences
m.plot2_neg
m.plot2_neg[m.plot2_neg>=0] <- 0
m.plot2_pos[m.plot2_pos<0 ] <- 0
barplot(height = m.plot2_neg, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years")
barplot(height = m.plot2_pos, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), las=1, xlab="person-years", add=TRUE)
## plot: mean time in state
m.plot2 <- cbind(soc=colSums(m.plot1_soc), int=colSums(m.plot1_int))
m.plot2
m.plot2 <- m.plot2[c("mci","mil","mod","sev"),]
## plot: mean time in state
m.plot2 <- cbind(soc=colSums(m.plot1_soc), int=colSums(m.plot1_int))
m.plot2 <- m.plot2[c("mci","mil","mod","sev"),]
temp.dif <- m.plot2[,"int"] - m.plot2[,"soc"] # difference in time in state (as column)
m.plot2_neg <- m.plot2_pos <- temp.dif # split positive and negative differences
m.plot2_neg[m.plot2_neg>=0] <- 0
m.plot2_pos[m.plot2_pos<0 ] <- 0
m.plot2_pos
m.plot2 <- cbind(m.plot2, m.plot2_neg, m.plot2_pos)
m.plot2
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
barplot(height = m.plot2_neg, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), col=c("green","yellow","orange","red"), add=TRUE)
barplot(height = m.plot2_pos, horiz = TRUE, xlim = c(min(m.plot2_neg),max(m.plot2_pos)), col=c("green","yellow","orange","red"), add=TRUE)
## plot: mean time in state
m.plot2 <- cbind(soc=colSums(m.plot1_soc), int=colSums(m.plot1_int))
m.plot2 <- m.plot2[c("mci","mil","mod","sev"),]
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
m.plot2
runApp('D:/surfdrive/PhD/Projects/IPECAD/open source model/2.0/shiny/online')
text(m.plot2, labels=m.plot2)
m.plot2
text(x=m.plot2[,"soc"], y=1, labels=m.plot2[,"soc"])
text(x=cumsum(m.plot2[,"soc"]), y=1, labels=m.plot2[,"soc"])
text(x=round(cumsum(m.plot2[,"soc"]),2), y=1, labels=m.plot2[,"soc"])
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=round(cumsum(m.plot2[,"soc"]),2), y=1, labels=m.plot2[,"soc"])
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=cumsum(m.plot2[,"soc"]), y=1, labels=round(m.plot2[,"soc"],1))
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=cumsum(m.plot2[2:4,"soc"]), y=1, labels=round(m.plot2[,"soc"],1))
m.plot2
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1))
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1), pos=4)
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=2, labels=round(m.plot2[,"soc"],1), pos=4)
# plot: mean time in state
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="topleft", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"int"])), y=2, labels=round(m.plot2[,"int"],1), pos=4)
# plot: mean time in state
par(mar=c(7, 4, 4, 2), xpd=TRUE)
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-2), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-1), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.1), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.2), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.3), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.4), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), fill=c("green","yellow","orange","red"))
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), horiz=TRUE, fill=c("green","yellow","orange","red"))
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.4), horiz=TRUE, fill=c("green","yellow","orange","red"))
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), horiz=TRUE, fill=c("green","yellow","orange","red"))
# plot: mean time in state
par(mar=c(8, 4, 4, 2), xpd=TRUE)
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), horiz=TRUE, fill=c("green","yellow","orange","red"))
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"int"])), y=2, labels=round(m.plot2[,"int"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=0, labels=round(m.plot2[,"soc"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"int"])), y=1, labels=round(m.plot2[,"int"],1), pos=4)
text(x=c(0,cumsum(m.plot2[1:3,"soc"])), y=1, labels=round(m.plot2[,"soc"],1), pos=3)
## table: icer
print(icer)
# plot: state trace
matplot(
x = c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1)),
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black"),
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
# plot: state trace
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
matplot(
x = c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1)),
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black"),
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
# plot: mean time in state
par(mar=c(8, 4, 4, 2), xpd=FALSE)
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), horiz=TRUE, fill=c("green","yellow","orange","red"))
# plot: mean time in state
par(mar=c(8, 4, 4, 2), xpd=TRUE)
barplot(
height = m.plot2,
horiz = TRUE,
xlab = "time (years)",
ylab = "strategy",
col=c("green","yellow","orange","red"),
space = 0.2,
main = "mean time in state"
)
legend(x="bottom", legend=c("mci","mil","mod","sev"), inset=c(0,-0.5), horiz=TRUE, fill=c("green","yellow","orange","red"))
## plot: icer
icer <- calculate_icers(
cost = out_base[["df.out_sum"]][,"COST"],
effect = out_base[["df.out_sum"]][,"QALY"],
strategies = out_base[["df.out_sum"]][,"strategy"]
)
## table: icer
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
## plot: icer
plot(icer, label="all")
# plot: state trace
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
matplot(
x = c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1)),
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black"),
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
matlines(
x = c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1)),
y = m.plot1[,6:10],
type = "l",
lty = 2,
col = c("green","yellow","orange","red","black")
)
legend(x="topright", legend=c("mci","mil","mod","sev","dth"), col=c("green","yellow","orange","red","black"), lty=1)
legend(x="right", legend=c("soc","int"), col="black", lty=c(1,2))
n <- 10
xx <- c(0:n, n:0)
xx
yy <- c(c(0, cumsum(stats::rnorm(n))), rev(c(0, cumsum(stats::rnorm(n)))))
yy
plot   (xx, yy, type = "n", xlab = "Time", ylab = "Distance")
polygon(xx, yy, col = "gray", border = "red")
plot   (xx, yy, xlab = "Time", ylab = "Distance")
polygon(xx, yy, col = "gray", border = "red")
temp.age_range <- c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1))
v.age_range
v.age_range <- c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1))
v.age_range
xx <- c(v.age_range, -v.age_range)
xx
xx <- c(v.age_range, rev(v.age_range))
xx
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1:5], m.plot1[,6:10])
plot   (xx, yy, xlab = "Time", ylab = "Distance")
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1:5], m.plot1[,6:10])
plot   (xx, yy, xlab = "Time", ylab = "Distance")
m.plot1[,1:5]
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1["mci",1:5], m.plot1["mci",6:10])
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1["mci",1:5], m.plot1["mci",6:10])
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1], m.plot1[,6])
plot   (xx, yy, xlab = "Time", ylab = "Distance")
polygon(xx, yy, col = "gray", border = "red")
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1], rev(m.plot1[,6]))
plot   (xx, yy, xlab = "Time", ylab = "Distance")
polygon(xx, yy, col = "gray", border = "red")
polygon(xx, yy, col = "gray", border = NULL)
polygon(xx, yy, col = "gray", border = "n")
polygon(xx, yy, col = "green", border = "n")
polygon(xx, yy, col = "green", border = NULL)
polygon(xx, yy, col = "green", border = NULL)
polygon(xx, yy, col = "green", border = FALSE)
# plot: state trace
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
v.age_range <- c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1))
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black"),
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
matlines(
x = v.age_range,
y = m.plot1[,6:10],
type = "l",
lty = 2,
col = c("green","yellow","orange","red","black")
)
legend(x="topright", legend=c("mci","mil","mod","sev","dth"), col=c("green","yellow","orange","red","black"), lty=1)
legend(x="right", legend=c("soc","int"), col="black", lty=c(1,2))
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1], rev(m.plot1[,6]))
polygon(xx, yy, col = "green", border = FALSE)
polygon(xx, yy, col = "gray95", border = FALSE)
matplot(
x = v.age_range,
y = NULL,
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "n",
xlab = "age",
ylab = "proportion in state",
main = "state trace"
)
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "n",
xlab = "age",
ylab = "proportion in state",
ylim = c(0,1),
main = "state trace"
)
matlines(
x = v.age_range,
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black")
)
matlines(
x = v.age_range,
y = m.plot1[,6:10],
type = "l",
lty = 2,
col = c("green","yellow","orange","red","black")
)
# plot: state trace
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
v.age_range <- c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1))
xx <- c(v.age_range, rev(v.age_range))
yy <- c(m.plot1[,1], rev(m.plot1[,6]))
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "n",
xlab = "age",
ylab = "proportion in state",
ylim = c(0,1),
main = "state trace"
)
polygon(xx, yy, col = "gray95", border = FALSE)
matlines(
x = v.age_range,
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black")
)
matlines(
x = v.age_range,
y = m.plot1[,6:10],
type = "l",
lty = 2,
col = c("green","yellow","orange","red","black")
)
xx <- c(v.age_range, rev(v.age_range))
yy_mci <- c(m.plot1[,1], rev(m.plot1[,6]))
yy_mil <- c(m.plot1[,2], rev(m.plot1[,7]))
yy_mod <- c(m.plot1[,3], rev(m.plot1[,8]))
yy_sev <- c(m.plot1[,4], rev(m.plot1[,9]))
yy_dth <- c(m.plot1[,5], rev(m.plot1[,10]))
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "n",
xlab = "age",
ylab = "proportion in state",
ylim = c(0,1),
main = "state trace"
)
polygon(xx, yy_mci, col = "gray95", border = FALSE)
polygon(xx, yy_mil, col = "gray95", border = FALSE)
polygon(xx, yy_mod, col = "gray95", border = FALSE)
polygon(xx, yy_sev, col = "gray95", border = FALSE)
polygon(xx, yy_dth, col = "gray95", border = FALSE)
matlines(
x = v.age_range,
y = m.plot1[,1:5],
type = "l",
lty = 1,
col = c("green","yellow","orange","red","black")
)
matlines(
x = v.age_range,
y = m.plot1[,6:10],
type = "l",
lty = 2,
col = c("green","yellow","orange","red","black")
)
legend(x="topright", legend=c("mci","mil","mod","sev","dth"), col=c("green","yellow","orange","red","black"), lty=1)
legend(x="right", legend=c("soc","int"), col="black", lty=c(1,2))
n.cycle
a.plot1 <- array(data=c(m.plot1_soc,m.plot1_int), dim=c(nrow(m.plot1_soc),5,2))
a.plot1
a.plot1 <- array(data=c(m.plot1_soc,m.plot1_int), dim=c(nrow(m.plot1_soc),5,2), dimnames=list(NULL,colnames(m.plot1_soc),c("soc","int")))
a.plot1
yy_mci <- c(a.plot1[,"mci","soc"], rev(a.plot1[,"mci","int"]))
yy_mci
# plot: state trace
par(mar=c(5, 4, 4, 2)+0.1, xpd=FALSE)
v.age_range <- c(l.inputs[["age_start"]]:(l.inputs[["age_end"]]-1))
xx <- c(v.age_range, rev(v.age_range))
yy_mci <- c(a.plot1[,"mci","soc"], rev(a.plot1[,"mci","int"]))
matplot(
x = v.age_range,
y = m.plot1[,1:5],
type = "n",
xlab = "age",
ylab = "proportion in state",
ylim = c(0,1),
main = "state trace"
)
polygon(xx, yy_mci, col = "gray95", border = FALSE)
debugSource("~/GitHub/IPECAD/AD open-source model.R", echo=TRUE)
debugSource("~/GitHub/IPECAD/AD open-source model.R", echo=TRUE)
plot(icer, label="all")
debugSource("~/GitHub/IPECAD/AD open-source model.R", echo=TRUE)
cat("\014") # clear console
rm(list = ls()) # clear environment
library(dampack) # load package
source("~/GitHub/IPECAD/AD open-source model.R", echo=TRUE)
